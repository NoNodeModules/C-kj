{"remainingRequest":"D:\\桌面收纳盒\\codetext\\kjsuper\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\桌面收纳盒\\codetext\\kjsuper\\src\\views\\detail\\Detail.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"D:\\桌面收纳盒\\codetext\\kjsuper\\src\\views\\detail\\Detail.vue","mtime":1617451697758},{"path":"D:\\桌面收纳盒\\codetext\\kjsuper\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\桌面收纳盒\\codetext\\kjsuper\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\桌面收纳盒\\codetext\\kjsuper\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\桌面收纳盒\\codetext\\kjsuper\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\桌面收纳盒\\codetext\\kjsuper\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQojZGV0YWlsew0KICBwb3NpdGlvbjogcmVsYXRpdmU7DQogIHotaW5kZXg6IDk5OTsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsNCiAgaGVpZ2h0OiAxMDB2aDsNCiAgDQp9DQoNCi5jb250ZW50aGV7DQogIGhlaWdodDogY2FsYygxMDAlIC0gNDRweCAtIDUycHgpOw0KfQ0KDQouZGV0YWlsLW5hdnsNCiAgcG9zaXRpb246IHJlbGF0aXZlOw0KICB6LWluZGV4OiA5OTk7DQogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7DQp9DQo="},{"version":3,"sources":["Detail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2OA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"Detail.vue","sourceRoot":"src/views/detail","sourcesContent":["<template>\r\n  <div id=\"detail\">\r\n    <detail-nav-bar class=\"detail-nav\" @titleClick=\"titleClick\" ref=\"nav\"></detail-nav-bar>\r\n    <scroll class=\"contenthe\" ref=\"Homescroll\" :probe-type=\"3\" @scroll=\"contentScroll\">\r\n      <detail-swiper :top-images=\"topImages\"></detail-swiper>\r\n      <detail-base-info :goods=\"goods\"></detail-base-info>\r\n      <detail-shop-info :shop=\"shop\"></detail-shop-info>\r\n      <detail-goods-info :detail-info=\"detailInfo\" @imageLoad=\"imageLoad\"></detail-goods-info>\r\n      <detail-param-info :paramInfo=\"paramInfo\" ref=\"params\"></detail-param-info>\r\n      <deta-comment-info :commentInfo=\"commentInfo\" ref=\"comment\"></deta-comment-info>\r\n      <goods-list :goods=\"recommends\" ref=\"recommend\"></goods-list>\r\n    </scroll>\r\n    <back-top @click.native=\"backClick\" v-show=\"isShowBackTo\"></back-top>\r\n    <deta-bottom-bar @addToCart=\"addToCart\" @isDetaInfo=\"isDetaInfo\"></deta-bottom-bar>\r\n    <!-- <toast  :message=\"message\" :show=\"show\"></toast> -->\r\n    <deta-info :isDetaInfo=\"isInfo\" :skuInfo=\"skuInfo\" :shop=\"shop\" :iid=\"iid\" @infoClose=\"infoClose\"></deta-info>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport DetailNavBar from './childComps/DetailNavBar'\r\nimport DetailSwiper from './childComps/DetailSwiper'\r\nimport DetailBaseInfo from './childComps/DetailBaseInfo'\r\nimport DetailShopInfo from './childComps/DetailShopInfo'\r\nimport DetailGoodsInfo from './childComps/DetailGoodsInfo'\r\nimport DetailParamInfo from './childComps/DetailParamInfo'\r\nimport DetaCommentInfo from './childComps/DetaCommentInfo'\r\nimport DetaBottomBar from './childComps/DetaBottomBar'\r\nimport DetaInfo from './childComps/DetaInfo'\r\n\r\nimport BackTop from '../../components/content/backTop/BackTop'\r\n\r\nimport Scroll from '../../components/common/scroll/Scroll'\r\n\r\nimport {getDetail,Goods,Shop,GoodsParam,getRecommend} from '../../network/detail.js'\r\nimport {debounce} from '../../common/utils'\r\n\r\nimport GoodsList from '../../components/content/goods/GoodsList'\r\n\r\n// import Toast from '../../components/common/toast/Toast';\r\n\r\nexport default {\r\n  name:'Detail',\r\n  data() {\r\n    return {\r\n      iid:null,\r\n      topImages:[],\r\n      goods:{},\r\n      shop:{},\r\n      detailInfo:{},\r\n      paramInfo:{},\r\n      commentInfo:{},\r\n      recommends:[],\r\n      themeTopYs:[],\r\n      getThemeTopY:null,\r\n      positionY:0,\r\n      currentIndex:0,\r\n      isShowBackTo:false,\r\n      // message:'',\r\n      // show:false\r\n      // 购物车数据\r\n      skuInfo:{},\r\n      // 加入购物车显示隐藏\r\n      isInfo:false\r\n    }\r\n  },\r\n  created() {\r\n    // 1 保存传入的iid\r\n    this.iid = this.$route.params.iid\r\n\r\n    // 2 根据iid请求详情数据\r\n    getDetail(this.iid).then(res => {\r\n      // console.log('true1')\r\n      // console.log(res);\r\n      // 简写 const data = res.data.result\r\n       const data = res.data.result\r\n      //  console.log(data.skuInfo);\r\n\r\n      // 1.获取顶部图片 轮播数据\r\n      this.topImages = data.itemInfo.topImages\r\n      \r\n\r\n      // 2.获取商品信息\r\n     \r\n      this.goods = new Goods(data.itemInfo,data.columns,data.shopInfo.services)\r\n\r\n      // 3.创建店铺信息\r\n      this.shop = new Shop(data.shopInfo)\r\n\r\n      // 4. 保存商品详情信息\r\n      this.detailInfo = data.detailInfo\r\n\r\n      // 5.保存参数信息\r\n      this.paramInfo = new GoodsParam(data.itemParams.info,data.itemParams.rule)\r\n    \r\n      // 6.保存评论信息\r\n      if(data.rate.cRate !== 0){\r\n        this.commentInfo = data.rate.list[0]\r\n        // console.log(this.commentInfo)\r\n      }\r\n      \r\n\r\n      // 获取商品 加入购物车时 选择框内部数据\r\n      this.skuInfo = data.skuInfo\r\n      // console.log(this.skuInfo);\r\n\r\n      \r\n    }),\r\n\r\n    // 3 请求推荐数据\r\n    getRecommend().then(res => {\r\n      // console.log(res)\r\n      this.recommends = res.data.data.list\r\n    })\r\n      \r\n      \r\n      // 4 给getThemeTopY赋值  进行防抖\r\n    this.getThemeTopY = debounce(() => {\r\n        this.themeTopYs=[]\r\n        // navbar 点击跳转\r\n        this.themeTopYs.push(0)\r\n        this.themeTopYs.push(this.$refs.params.$el.offsetTop-44)\r\n        this.themeTopYs.push(this.$refs.comment.$el.offsetTop-44)\r\n        this.themeTopYs.push(this.$refs.recommend.$el.offsetTop-44)\r\n        this.themeTopYs.push(Number.MAX_VALUE)\r\n        // console.log('true2')\r\n    })\r\n  },\r\n  components:{\r\n    DetailNavBar,\r\n    DetailSwiper,\r\n    DetailBaseInfo,\r\n    DetailShopInfo,\r\n    Scroll,\r\n    DetailGoodsInfo,\r\n    DetailParamInfo,\r\n    DetaCommentInfo,\r\n    GoodsList,\r\n    DetaBottomBar,\r\n    BackTop,\r\n    DetaInfo,\r\n    // Toast\r\n  },\r\n  methods: {\r\n    imageLoad(){\r\n      this.$refs.Homescroll.refresh()\r\n\r\n      this.getThemeTopY()\r\n    },\r\n    titleClick(index){\r\n      // console.log(index)\r\n      this.$refs.Homescroll.scrollTo(0,-this.themeTopYs[index],100)\r\n    },\r\n    contentScroll(position){\r\n      const positionY = -position.y\r\n\r\n      let length = this.themeTopYs.length\r\n\r\n      for(let i=0;i<length;i++){\r\n\r\n        // if(this.currentIndex !== i &&((i < length - 1 && positionY >= this.themeTopYs[i] && positionY < this.themeTopYs[i+1]) || (i ===\r\n        // length -1 && positionY >= this.themeTopYs[i]))){\r\n        //   this.currentIndex = i;\r\n        //   console.log(this.currentIndex)\r\n        //   this.$refs.nav.currentIndex = this.currentIndex\r\n        // }\r\n\r\n\r\n        // DetailNavBar滚动到 位置时  改变  [商品，参数，评论，推荐]\r\n        if(this.currentIndex !== i && (positionY >= this.themeTopYs[i] && positionY < this.themeTopYs[i+1])){\r\n          this.currentIndex = i\r\n          this.$refs.nav.currentIndex = this.currentIndex\r\n        }\r\n\r\n      }\r\n\r\n      // 判断 返回按钮backTop 隐藏还是现实\r\n      this.isShowBackTo = position.y <-1000\r\n\r\n\r\n    },\r\n    backClick(){\r\n      this.$refs.Homescroll.scrollTo(0,0,500)\r\n    },\r\n    addToCart(){\r\n      // 1 获取购物车 需要展示的信息\r\n      const product = {}\r\n      product.image = this.topImages[0]\r\n      product.title = this.goods.title\r\n      product.desc = this.goods.desc\r\n      product.price = this.goods.realPrice\r\n      product.iid = this.iid\r\n      // console.log(product)\r\n      // console.log(this.goods)\r\n\r\n      // 2 将商品添加到购物车里(使用了vuex)\r\n      // ↓    mutations\r\n      // this.$store.commit('addCart',product)\r\n      // ↓☆  actions  将数据发送到vuex 中\r\n      // this.$store.dispatch('addCart',product)  \r\n      this.$store.dispatch('addCart',product).then(res => {\r\n        // this.show = true\r\n        // this.message = res\r\n        // setTimeout(() => {\r\n        //   this.show = false\r\n        //   this.message = \"\"\r\n        // },1500)\r\n        this.$toast.show(res,1500)\r\n        console.log(res)\r\n      })\r\n    },\r\n    // 加入购物车的显示与隐藏\r\n    isDetaInfo(isInfo){\r\n      // console.log(isInfo);\r\n      this.isInfo = isInfo\r\n    },\r\n    infoClose(){\r\n      this.isInfo = false\r\n    }\r\n  },\r\n  mounted() {\r\n    // const refresh = debounce(this.$refs.Homescroll.refresh,50)\r\n    // this.$bus.$on('datailimgLoad',() => {\r\n    //   refresh()\r\n    //   console.log('防抖')\r\n    // })\r\n  },\r\n  updated() {\r\n    \r\n  },\r\n}\r\n</script>\r\n\r\n<style>\r\n#detail{\r\n  position: relative;\r\n  z-index: 999;\r\n  background-color: #fff;\r\n  height: 100vh;\r\n  \r\n}\r\n\r\n.contenthe{\r\n  height: calc(100% - 44px - 52px);\r\n}\r\n\r\n.detail-nav{\r\n  position: relative;\r\n  z-index: 999;\r\n  background-color: #fff;\r\n}\r\n</style>"]}]}